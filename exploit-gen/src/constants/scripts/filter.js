import fs from 'fs';
import csv from 'csv-parser';
import { Parser } from 'json2csv';

const filePath = '../thething-markups/dom-clobbering-markups.csv';
const outputFilePath = '../thething-markups/dom-clobbering-markups-fc.csv';

const filteredRows = [];

fs.createReadStream(filePath)
  .pipe(csv())
  .on('data', (row) => {
    if (row['Chrome-Desktop_96'] === '1' || row['Firefox-Desktop_95.0'] === '1') {
      const filteredRow = {
        markup: row.markup,
        clobbered: row.clobbered,
        tag1: row.tag1,
        tag2: row.tag2,
        attribute1: row.attribute1,
        attribute2: row.attribute2,
        relation_type: row.relation_type,
        reference_type: row.reference_type,
        'Chrome-Desktop_96': row['Chrome-Desktop_96'],
        'Firefox-Desktop_95.0': row['Firefox-Desktop_95.0']
      };
      filteredRows.push(filteredRow);
    }
  })
  .on('end', () => {
    const json2csvParser = new Parser();
    const csvOutput = json2csvParser.parse(filteredRows);

    fs.writeFile(outputFilePath, csvOutput, (err) => {
      if (err) {
        console.error('Error writing to file:', err);
      } else {
        console.log(`Filtered data has been written to ${outputFilePath}`);
      }
    });
  });
